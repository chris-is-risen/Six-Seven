<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Will you get Six-Seven?</title>

<style>
body {
    font-family: 'Comic Sans MS', cursive;
    margin: 40px;
    max-width: 900px;
}
input, button {
    margin: 5px 0;
    padding: 6px;
    font-size: 14px;
}
table {
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    border: 1px solid #ccc;
    padding: 6px 10px;
    text-align: center;
}
th {
    background: #f0f0f0;
}

#confettiCanvas {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    width: 100vw;
    height: 100vh;
    display: none;
    z-index: 1000;
}

#celebrationGif {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    z-index: 1001;
    width: 90vw;
    max-width: 600px;
}
</style>
</head>

<body>

<h1>Will you get Six-Seven?</h1>

<label>
Number of dice per roll:
<input type="number" id="numDice" min="1" value="42">
</label><br>

<label>
Number of iterations:
<input type="number" id="numIterations" min="1" value="1">
</label><br>

<button id="runBtn">Run Simulation</button>

<h2>Results</h2>
<div id="summary"></div>

<table id="resultsTable" style="display:none;">
<thead>
<tr>
<th>Iteration</th>
<th>Total 6s</th>
<th>Total even #s</th>
</tr>
</thead>
<tbody></tbody>
</table>

<canvas id="confettiCanvas"></canvas>

<!-- PRE-RENDERED TENOR GIF (critical) -->
<div id="celebrationGif">
    <div class="tenor-gif-embed"
         data-postid="9140868"
         data-share-method="host"
         data-aspect-ratio="1.78"
         data-width="100%">
    </div>
</div>

<script async src="https://tenor.com/embed.js"></script>

<script>
/* ---------------- Audio (mobile-safe) ---------------- */

const airhorn = new Audio("https://actions.google.com/sounds/v1/alarms/air_horn.ogg");
const applause = new Audio("https://actions.google.com/sounds/v1/human_voices/applause.ogg");

airhorn.playsInline = true;
applause.playsInline = true;
applause.loop = true;

/* iOS unlock trick */
function unlockAudio() {
    airhorn.muted = true;
    applause.muted = true;

    airhorn.play().then(() => {
        airhorn.pause();
        airhorn.muted = false;
    }).catch(()=>{});

    applause.play().then(() => {
        applause.pause();
        applause.muted = false;
    }).catch(()=>{});
}

/* ---------------- Celebration ---------------- */

let confettiId = null;

function playCelebrationSounds() {
    airhorn.currentTime = 0;
    applause.currentTime = 0;

    airhorn.play().catch(()=>{});
    applause.play().catch(()=>{});

    setTimeout(() => {
        airhorn.pause();
        airhorn.currentTime = 0;
    }, 3000);
}

function stopCelebrationSounds() {
    airhorn.pause();
    applause.pause();
    airhorn.currentTime = 0;
    applause.currentTime = 0;
}

function launchCelebration() {
    playCelebrationSounds();

    document.getElementById("celebrationGif").style.display = "block";

    const canvas = document.getElementById("confettiCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    canvas.style.display = "block";

    const pieces = Array.from({ length: 200 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        r: Math.random() * 6 + 4,
        dy: Math.random() * 3 + 2,
        color: `hsl(${Math.random() * 360}, 100%, 50%)`
    }));

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (const p of pieces) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
            p.y += p.dy;
            if (p.y > canvas.height) p.y = -10;
        }
        confettiId = requestAnimationFrame(animate);
    }

    animate();
}

function clearCelebration() {
    cancelAnimationFrame(confettiId);
    document.getElementById("confettiCanvas").style.display = "none";
    document.getElementById("celebrationGif").style.display = "none";
    stopCelebrationSounds();
}

/* ---------------- Simulation ---------------- */

function runSimulation() {
    clearCelebration();

    const nDice = +numDice.value;
    const iterations = +numIterations.value;

    let success = false;
    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";

    for (let i = 0; i < iterations; i++) {
        let sixes = 0;
        let evens = 0;

        for (let d = 0; d < nDice; d++) {
            const roll = Math.floor(Math.random() * 6) + 1;
            if (roll === 6) sixes++;
            if (roll % 2 === 0) evens++;
        }

        if (sixes === 7) success = true;

        tbody.innerHTML += `<tr><td>${i+1}</td><td>${sixes}</td><td>${evens}</td></tr>`;
    }

    resultsTable.style.display = "table";

    if (success) launchCelebration();
}

/* ---------------- Button wiring ---------------- */

document.getElementById("runBtn").addEventListener("click", () => {
    unlockAudio();      // MUST happen first
    runSimulation();
});
</script>

</body>
</html>
