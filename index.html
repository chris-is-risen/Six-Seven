<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Will you get Six-Seven?</title>
<style>
body {
    font-family: 'Comic Sans MS', cursive;
    margin: 40px;
    max-width: 900px;
}
input, button {
    margin: 5px 0;
    padding: 6px;
    font-size: 14px;
}
table {
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    border: 1px solid #ccc;
    padding: 6px 10px;
    text-align: center;
}
th {
    background: #f0f0f0;
}

#confettiCanvas {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    width: 100vw;
    height: 100vh;
    display: none;
    z-index: 1000;
}

#celebrationGif {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
    z-index: 1001;
    width: 90vw;
    max-width: 600px;
}
</style>
</head>
<body>

<h1>Will you get Six-Seven?</h1>

<label>
Number of dice per roll:
<input type="number" id="numDice" min="1" value="42">
</label><br>

<label>
Number of iterations:
<input type="number" id="numIterations" min="1" value="1">
</label><br>

<button onclick="runSimulation()">Run Simulation</button>

<h2>Results</h2>
<div id="summary"></div>

<table id="resultsTable" style="display:none;">
<thead>
<tr>
<th>Iteration</th>
<th>Total 6s</th>
<th>Total even #s</th>
</tr>
</thead>
<tbody></tbody>
</table>

<canvas id="confettiCanvas"></canvas>

<div id="celebrationGif"></div>

<script async src="https://tenor.com/embed.js"></script>

<script>
/* ---------------- Probability ---------------- */

function binomialCoefficient(n, k) {
    if (k < 0 || k > n) return 0;
    if (k === 0 || k === n) return 1;
    k = Math.min(k, n - k);
    let r = 1;
    for (let i = 1; i <= k; i++) {
        r *= (n - k + i);
        r /= i;
    }
    return r;
}

function theoreticalProbabilityExactlySevenSixes(n) {
    return binomialCoefficient(n, 7) * Math.pow(1/6, 7) * Math.pow(5/6, n - 7);
}

/* ---------------- Tenor GIF system ---------------- */

/*
Add future Tenor GIFs here.
Index 0 is the one currently used.
*/
const tenorGifs = [
    {
        postid: "9140868",
        aspect: "1.78"
    }
];

function showTenorGif(index = 0) {
    const container = document.getElementById("celebrationGif");

    /* Force re-render so animation restarts */
    container.innerHTML = "";

    const gif = tenorGifs[index];

    container.innerHTML = `
        <div class="tenor-gif-embed"
             data-postid="${gif.postid}"
             data-share-method="host"
             data-aspect-ratio="${gif.aspect}"
             data-width="100%">
        </div>
    `;

    container.style.display = "block";

    /* Reinitialize Tenor after DOM change */
    if (window.Tenor && Tenor.Embed) {
        Tenor.Embed.load();
    }
}

/* ---------------- Audio ---------------- */

const airhorn = new Audio("https://actions.google.com/sounds/v1/alarms/air_horn.ogg");
const applause = new Audio("https://actions.google.com/sounds/v1/human_voices/applause.ogg");

airhorn.playsInline = true;
applause.playsInline = true;
applause.loop = true;

function playCelebrationSounds() {
    airhorn.currentTime = 0;
    applause.currentTime = 0;

    airhorn.play().catch(()=>{});
    applause.play().catch(()=>{});

    setTimeout(() => {
        airhorn.pause();
        airhorn.currentTime = 0;
    }, 3000);
}

function stopCelebrationSounds() {
    airhorn.pause();
    applause.pause();
    airhorn.currentTime = 0;
    applause.currentTime = 0;
}

/* ---------------- Confetti ---------------- */

let confettiAnimationId = null;

function launchCelebration() {
    playCelebrationSounds();
    showTenorGif(0);

    const canvas = document.getElementById("confettiCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    canvas.style.display = "block";

    const pieces = Array.from({ length: 200 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        r: Math.random() * 6 + 4,
        dy: Math.random() * 3 + 2,
        color: `hsl(${Math.random() * 360}, 100%, 50%)`
    }));

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (const p of pieces) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
            p.y += p.dy;
            if (p.y > canvas.height) p.y = -10;
        }
        confettiAnimationId = requestAnimationFrame(animate);
    }

    animate();
}

function clearCelebration() {
    cancelAnimationFrame(confettiAnimationId);
    document.getElementById("confettiCanvas").style.display = "none";
    document.getElementById("celebrationGif").style.display = "none";
    stopCelebrationSounds();
}

/* ---------------- Simulation ---------------- */

function runSimulation() {
    clearCelebration();

    const nDice = parseInt(document.getElementById("numDice").value);
    const iterations = parseInt(document.getElementById("numIterations").value);

    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";

    let countExactlySeven = 0;

    for (let i = 0; i < iterations; i++) {
        let sixes = 0;
        let evens = 0;

        for (let d = 0; d < nDice; d++) {
            const roll = Math.floor(Math.random() * 6) + 1;
            if (roll === 6) sixes++;
            if (roll % 2 === 0) evens++;
        }

        if (sixes === 7) countExactlySeven++;

        tbody.innerHTML += `<tr><td>${i+1}</td><td>${sixes}</td><td>${evens}</td></tr>`;
    }

    document.getElementById("resultsTable").style.display = "table";

    const empiricalProb = countExactlySeven / iterations;
    const theoreticalSingle = theoreticalProbabilityExactlySevenSixes(nDice);
    const theoreticalAtLeastOnce =
        1 - Math.pow(1 - theoreticalSingle, iterations);

    document.getElementById("summary").innerHTML = `
        <p><strong>Dice per roll:</strong> ${nDice}</p>
        <p><strong>Iterations:</strong> ${iterations}</p>
        <p><strong>Empirical P(at least one success):</strong> ${empiricalProb.toFixed(6)}</p>
        <p><strong>Theoretical P(single roll):</strong> ${theoreticalSingle.toFixed(6)}</p>
        <p><strong>Theoretical P(at least once):</strong> ${theoreticalAtLeastOnce.toFixed(6)}</p>
    `;

    if (countExactlySeven > 0) {
        launchCelebration();
    }
}
</script>

</body>
</html>
